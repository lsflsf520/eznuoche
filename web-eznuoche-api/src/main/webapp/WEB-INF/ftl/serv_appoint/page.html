<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>客户预约管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="/static/css/mui.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/mui.picker.min.css">
    <link rel="stylesheet" href="/static/css/global.css?v=1">
    <link rel="stylesheet" href="/static/css/redColor.css?v=1">
    <link rel="stylesheet" href="/static/css/template.css?v=1">
    <link rel="stylesheet" href="/static/css/index.css?v=1">
    <link rel="stylesheet" href="/static/css/iconfont.css" />
    <style>
        .mui-pull-bottom-tips {  text-align: center;  background-color: #fff;  font-size: 15px;  line-height: 40px;  color: #777;  }
        .mui-fullscreen{  top: 5rem; height: auto; }
        .mui-segmented-control.mui-scroll-wrapper .mui-scroll{width: 100%;display: flex;}
        .mui-segmented-control.mui-scroll-wrapper .mui-scroll a{width: 50%;padding: 0;}
        .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{background: url("../image/chexiandingdanxiahuaxin@2x.png") no-repeat bottom center; background-size: 100% .02rem;color: #000;}
        .mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item{border-top: 0;}
        .mui-segmented-control.mui-scroll-wrapper{height: 40px;}
        .mui-table-view-cell:after{right: 15px;}
        .mask{z-index: 2;}
        .jiz_dongt .gt_huxzlg{
        	z-index: 100000;
        }
    </style>
</head>
<body>
<div class="my_deqianb">
    <div class="tit_com">
				<div class="content_min" style="padding-bottom: 0.2rem;">
					<ul>
						<li class="flex">
							<div class="plate">客户姓名</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="" id="kehuName" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">联系方式</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="请输入手机号" id="kehuPhone" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">预约时间</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="" id="appointTime" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">服务内容</div>
							<div class="plate_dex flex">
							    <input type="text" placeholder="" id="servContent" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
					</ul>
					
					<div class="The_false" id="btn">
						保   存
					</div>
				</div>	
			</div>
</div>
<div class="kqh_tuanx">
    <div class="mui-content" id="logDiv">
        <ul class="mui-table-view" id="yj_shouru">
        
        </ul>
    </div>

</div>
<script src="/static/js/jquery-1.12.2.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mui.min.js"></script>
<script src="/static/js/mui.pullToRefresh.js?v=1"></script>
<script src="/static/js/mui.pullToRefresh.material.js?v=1"></script>
<script src="/static/js/mui.picker.min.js"></script>
<script src="/static/js/apiurl.js?v=1 " type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mask.js?v=1" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/common.js?v=1"></script>
<script src="/static/js/main.js?v=1" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/template.js" type="text/javascript" charset="utf-8"></script>
<script>
    var page = 1;
    var page2 = 1;
    mui.init();
    (function($) {
        //阻尼系数
        $.ready(function() {
            //循环初始化所有下拉刷新，上拉加载。
                $("#logDiv").pullToRefresh({
                    up: {
                        callback: function() {
                            var self = this;
                            setTimeout(function() {
                                var ul = self.element.querySelector('.mui-table-view');
                                ul.appendChild(createFragment(ul, 5,self));
                                self.endPullUpToRefresh();
                            }, 1000);
                        },
                        auto:true
                    }
                });
            var createFragment = function(ul, count, self) {
                var fragment = document.createDocumentFragment();
                (function(){
                        var commit = {
                            timeoutFn: function () {
                                mui.toast('请求超时')
                            }
                        };
                        function successfn(data) {
                        	 var Data = data.model
						    if(page > Data.totalPages){//当datas.length为0时，表示没有数据了
						        self.endPullUpToRefresh(true);//当为true时，底部出现没有更多数据，并且不能滑动
						    }else{
                                page = data.model.currPage + 1;
                                var li;
                                for (var i = 0; i < data.model.datas.length; i++) {
                                    li = document.createElement('li');
                                    li.className = 'mui-table-view-cell';
                                    
                                    li.innerHTML = '<div class="yj_shouruz"><div class="uz_left"><p><span class="col008">'
                                                    +data.model.datas[i].kehuName+'</span><span><a href="tel://'+data.model.datas[i].phone+'">'+data.model.datas[i].hidePhone+'</a></span></p><p>'
                                                    +data.model.datas[i].servContent+'</p></div><div class="uz_right"><p>'
                                                    + data.model.datas[i].appointTimeStr + '</p><p>'
                                                    +data.model.datas[i].stateName+'</p></div></div>';
                                                    
                                    document.getElementById('yj_shouru').appendChild(li);
                                }
	                            if(page >= Data.totalPages){//当datas.length为0时，表示没有数据了
							        self.endPullUpToRefresh(true);//当为true时，底部出现没有更多数据，并且不能滑动
							    }else{
									self.endPullUpToRefresh();//当为false或空时，底部出现正在加载，滑动到下一页
								}
		                     }   
		                 }
                         Kino.ajax('/servAppoint/loadMyServAppoints.do?currPage='+page, successfn, commit);
                })()
                return fragment;
            };
        });
    })(mui);
    //我的钱包接口
     
</script>

<script type="text/javascript">

function showContent(tdId) {
	mui.toast($(tdId).attr("title"));
}

mui('.content_min').on('tap', '#appointTime', function(event){
	var currDate = new Date();
	var year=currDate.getFullYear(); 
	var  month=currDate.getMonth()+1;
	var day=currDate.getDate();
	var hour= currDate.getHours();
	var minute = currDate.getMinutes();

	var dtPicker = new mui.DtPicker({"value":"2015-10-10 10:10","beginYear":year,"beginMonth":month,"beginDay":day, "beginHours":hour, "beginMinutes":minute, "endYear":year+1}); 
	dtPicker.show(function (selectItems) { 
		var selectedTime = selectItems.y.value + "-" + selectItems.m.value + "-" + selectItems.d.value + " " + selectItems.h.value + ":" + selectItems.i.value;
		$('#appointTime').val(selectedTime);
	});
});

$("#btn").click(function(){
	var kehuName = $("#kehuName").val();
	var kehuPhone = $("#kehuPhone").val();
	var appointTime = $("#appointTime").val();
	var servContent = $("#servContent").val();
	if(!kehuName){
		mui.toast("客户姓名不能为空");
		return;
	}
	if(!kehuPhone || !/^1\d{10}$/.test(kehuPhone)) {
		mui.toast("客户手机号格式不正确");
		return;
	}
	if(!appointTime) {
		mui.toast("预约时间不能为空");
		return;
	}
	Kino.ajax('/servAppoint/add.do', function(response, status, xhr) {
		mui.toast("数据录入成功");
		window.location.reload();
	}, {
		type : "POST",
		data : {
			kehuName : kehuName,
			phone: kehuPhone,
			appointTime: appointTime + ":00",
			servContent: servContent
		},
		timeoutFn : function() {
			mui.toast('请求超时')
		}
	});
});
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>客户预约管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="/static/css/mui.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/mui.picker.min.css">
    <link rel="stylesheet" href="/static/css/global.css?v=1">
    <link rel="stylesheet" href="/static/css/redColor.css?v=1">
    <link rel="stylesheet" href="/static/css/template.css?v=1">
    <link rel="stylesheet" href="/static/css/index.css?v=1">
    <link rel="stylesheet" href="/static/css/iconfont.css" />
    <style>
        .mui-pull-bottom-tips {  text-align: center;  background-color: #fff;  font-size: 15px;  line-height: 40px;  color: #777;  }
        .mui-fullscreen{  top: 5rem; height: auto; }
        .mui-segmented-control.mui-scroll-wrapper .mui-scroll{width: 100%;display: flex;}
        .mui-segmented-control.mui-scroll-wrapper .mui-scroll a{width: 50%;padding: 0;}
        .mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{background: url("../image/chexiandingdanxiahuaxin@2x.png") no-repeat bottom center; background-size: 100% .02rem;color: #000;}
        .mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item{border-top: 0;}
        .mui-segmented-control.mui-scroll-wrapper{height: 40px;}
        .mui-table-view-cell:after{right: 15px;}
        .mask{z-index: 2;}
        .jiz_dongt .gt_huxzlg{
        	z-index: 100000;
        }
    </style>
</head>
<body>
<div class="my_deqianb">
    <div class="tit_com">
				<div class="content_min" style="padding-bottom: 0.2rem;">
					<ul>
						<li class="flex">
							<div class="plate">客户姓名</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="" id="kehuName" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">联系方式</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="请输入手机号" id="kehuPhone" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">预约时间</div>
							<div class="plate_dex flex">
								<input type="text" placeholder="" id="appointTime" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
						<li class="flex">
							<div class="plate">服务内容</div>
							<div class="plate_dex flex">
							    <input type="text" placeholder="" id="servContent" style="width: 5rem;margin-bottom:0rem;" autocomplete="off">
							</div>
						</li>
					</ul>
					
					<div class="The_false" id="btn">
						添加预约客户
					</div>
				</div>	
			</div>
</div>
<div class="kqh_tuanx">
	 <#if !(hasLogon!false) || (needBindPhone!false)>
         <div class="tit_com">
			<div class="content_min">
				<ul>
					<li class="flex">
						<div class="plate">手机号</div>
						<div class="plate_dex flex">
							<!--<b class="car_number">请输入您的姓名</b>-->
							<input type="number" id="plate_phone" placeholder="请输入您的手机号" style="width: 4.7rem;margin-bottom:0rem;" autocomplete="off">
							
						</div>
					</li>
					
					<li class="flex">
						<div class="plate">短信验证码</div>
						<div class="plate_dex flex">
							<input id="plate_smscode" type="text" style="width: 3rem;margin-bottom:0rem;margin-right: 0.1rem;" autocomplete="off">
							<input type="button" value="获取验证码" onclick="sendCode(this)" style="padding: 6px 4px;width: 1.6rem;">
						</div>
					</li>
					<!-- <li class="flex">
						<div class="plate">推荐码</div>
						<div class="plate_dex flex">
							<input type="text" placeholder="请输入推荐码，没有可不填写" id="plate_invite_code" style="width: 4rem;" autocomplete="off">
							<div class="le"><i class="compile"></i></div>
						</div>
					</li> -->
					<div class="The_false" id="zhuce_ym">
					    快捷登录
				    </div>
				    <div align="center" style="margin: 0.2rem;">
					   同意<a href="http://static.siyufank.cn/eznc/khagreement.html">《客户预约管理服务协议》</a>
					</div>
	  <#else>
		    <div class="mui-content" id="logDiv">
		        <ul class="mui-table-view" id="yj_shouru">
		        
		        </ul>
		    </div>
      </#if>

    <div style="margin: 1rem 0.35rem 0.35rem 0.2rem">
			    <div style="margin: 0rem 0.35rem;">
				<p>说明：</p>
				<p>1、本功能主要用于商家记录预约客户信息，比如餐饮行业、房产销售、KTV、足浴、理发店等服务行业均可使用本功能；</p>
				<p>2、快捷登录后，即可使用本功能；</p>
				<p>3、北京朝朝盈公司承诺记录客户信息的功能永久免费。</p>
				<p align="center" style="padding-bottom:0.3rem;">
				 <img style="width:2rem;height:2rem;margin:0.3rem 0 0.1rem 0;" alt="公众号二维码" src="/static/images/qrcode.png">
				 <span style="display:block;">关注微信公众号</span>
				</p>
	</div>
</div>
<script src="/static/js/jquery-1.12.2.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mui.min.js"></script>
<script src="/static/js/mui.pullToRefresh.js?v=1"></script>
<script src="/static/js/mui.pullToRefresh.material.js?v=1"></script>
<script src="/static/js/mui.picker.min.js"></script>
<script src="/static/js/apiurl.js?v=1 " type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mask.js?v=1" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/common.js?v=1"></script>
<script src="/static/js/main.js?v=1" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/template.js" type="text/javascript" charset="utf-8"></script>
<script>
var page = 1;
var url = '/servAppoint/loadMyIncomingServAppoints.do?currPage=';
var url2 = '/servAppoint/loadMyHistoryServAppoints.do?currPage=';
mui.init();

function createFragment(self) {
    var commit = {
                timeoutFn: function () {
                    mui.toast('请求超时')
                }
            };
            function successfn(data) {
                 var li;
                 for (var i = 0; i < data.model.datas.length; i++) {
                     li = document.createElement('li');
                     li.className = 'mui-table-view-cell';
                     
                     li.innerHTML = '<div class="yj_shouruz"><div class="uz_left"><p><span class="col008">'
                                     +data.model.datas[i].kehuName+'</span><span><a href="tel://'+data.model.datas[i].decryptPhone+'">'+data.model.datas[i].hidePhone+'</a></span></p><p>'
                                     +data.model.datas[i].servContent+'</p></div><div class="uz_right"><p>'
                                     + data.model.datas[i].appointTimeStr + '</p><p>'
                                     +data.model.datas[i].stateName+'</p></div></div>';
                                     
                     document.getElementById('yj_shouru').appendChild(li);
                 }
                 
                 page = data.model.currPage + 1;
                 if(page > data.model.totalPages){//当datas.length为0时，表示没有数据了
   			    	if(url == url2) { //如果当前已经把历史记录查完了，则可以终止查询
   				        self.endPullUpToRefresh(true);//当为true时，底部出现没有更多数据，并且不能滑动
                   	} else {
                   		url = url2;
                   		page = 1;
                   		createFragment(self);
                   	}
   			     }else{
					self.endPullUpToRefresh();//当为false或空时，底部出现正在加载，滑动到下一页
                 }   
             }
             Kino.ajax(url + page, successfn, commit);
}


    (function($) {
        //阻尼系数
        $.ready(function() {
        	  if($("#logDiv").length <= 0) {
        		  return;
        	  }
            //循环初始化所有下拉刷新，上拉加载。
              $("#logDiv").pullToRefresh({
                    up: {
                        callback: function() {
                            var self = this;
                            createFragment(self);
                            
                            //setTimeout(function() {
                                //var ul = self.element.querySelector('.mui-table-view');
                                //ul.appendChild(createFragment(ul, self));
                                //self.endPullUpToRefresh(false);
                            //}, 1000);
                        },
                        contentnomore:"没有更多数据了，请先添加预约客户",
                        auto:true
                    }
              });
        });
    })(mui);
    //我的钱包接口
     
</script>

<script type="text/javascript">

function showContent(tdId) {
	mui.toast($(tdId).attr("title"));
}

mui('.content_min').on('tap', '#appointTime', function(event){
	var currDate = new Date();
	var year=currDate.getFullYear(); 
	var  month=currDate.getMonth()+1;
	var day=currDate.getDate();
	var hour= currDate.getHours();
	var minute = currDate.getMinutes();

	var dtPicker = new mui.DtPicker({"value":"2015-10-10 10:10","beginYear":year,"beginMonth":month,"beginDay":day, "beginHours":hour, "beginMinutes":minute, "endYear":year+1}); 
	dtPicker.show(function (selectItems) { 
		var selectedTime = selectItems.y.value + "-" + selectItems.m.value + "-" + selectItems.d.value + " " + selectItems.h.value + ":" + selectItems.i.value;
		$('#appointTime').val(selectedTime);
	});
});

$("#btn").click(function(){
	var kehuName = $("#kehuName").val();
	var kehuPhone = $("#kehuPhone").val();
	var appointTime = $("#appointTime").val();
	var servContent = $("#servContent").val();
	if(!kehuName){
		mui.toast("客户姓名不能为空");
		return;
	}
	if(!kehuPhone || !/^1\d{10}$/.test(kehuPhone)) {
		mui.toast("客户手机号格式不正确");
		return;
	}
	if(!appointTime) {
		mui.toast("预约时间不能为空");
		return;
	}
	Kino.ajax('/servAppoint/add.do', function(response, status, xhr) {
		mui.toast("数据录入成功");
		window.location.reload();
	}, {
		type : "POST",
		data : {
			kehuName : kehuName,
			phone: kehuPhone,
			appointTime: appointTime + ":00",
			servContent: servContent
		},
		timeoutFn : function() {
			mui.toast('请求超时')
		}
	});
});
</script>

<#if signature??>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script type="text/javascript">
wx.config({
    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
    appId: '${(signature.appId)!}', // 必填，公众号的唯一标识
    timestamp: ${(signature.timestamp)!}, // 必填，生成签名的时间戳
    nonceStr: '${(signature.nonceStr)!}', // 必填，生成签名的随机串
    signature: '${(signature.signature)!}',// 必填，签名
    jsApiList: ['updateAppMessageShareData','updateTimelineShareData'] // 必填，需要使用的JS接口列表
});

wx.ready(function () {   //需在用户可能点击分享按钮前就先调用
    wx.updateAppMessageShareData({ 
        title: '您贴心的免费客户管理小助手，动动手指来看看吧', // 分享标题
        desc: '记录客户预约信息，掏出手机即可查看。有客户管理需求的销售人员均可免费使用。', // 分享描述
        link: '${linkUrl!}', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
        imgUrl: 'http://static.siyufank.cn/eznc/serv_logo.png', // 分享图标
        success: function () {
          // 设置成功
         // mui.toast("分享成功");
        }
    });
});
</script>
</#if>
</body>
</html>